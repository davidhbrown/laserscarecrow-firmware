<!DOCTYPE html>
<html lang="en">
<!--
C:\Users\dave\.espressif\python_env\idf4.4_py3.8_env\Scripts\python.exe C:\Users\dave\esp\esp-idf\components\esptool_py\esptool\esptool.py --chip esp32 merge_bin --output ls2022-1.3.0.bin --flash_mode dio --flash_freq 40m --flash_size 2MB 0x1000 ./bootloader/bootloader.bin 0x8000 ./partition_table/partition-table.bin 0x10000 ./ls2022_esp32.bin
-->
<head>
    <meta charset="UTF-8">
    <title>URI Laser Scarecrow Firmware</title>
    <link href="styles.css" rel="stylesheet">
    <!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">-->
</head>
<body>
<script
        type="module"
        src="https://unpkg.com/esp-web-tools@9/dist/web/install-button.js?module"
></script>
<header></header>
<!-- github.io pages can't find this in the subdirectory -->
<!--script
        type="module"
        src="node_modules/esp-web-tools/dist/web/install-button.js"
></script-->
<h1>URI Laser Scarecrow Firmware (2022-2024)</h1>
<p>Firmware is the program that gives a device its behavior. (Like software for a general-purpose computer but closely
    tied to specific hardware... I guess somewhere between &ldquo;soft&rdquo; and &ldquo;hard&rdquo; is &ldquo;firm?&rdquo;)
    In the URI Laser Scarecrow,
    the behavior is managed by a microcontroller &mdash; a small system-on-a-chip optimized for controlling hardware
    &mdash;
    and the microcontroller module holds the laser scarecrow firmware. </p>
<p>Occasionally we make small changes to the behavior of the URI laser scarecrow after the kits or devices have
    shipped out. You can update your unit to take advantage of these changes here.
    Or if you needed to replace the microcontroller, you could program the new one using this page.</p>
<h2>What you need</h2>
<ul>
    <li>A computer (not a phone/tablet) and the <a href="https://www.google.com/chrome/">Chrome</a>
        or Edge browser (not Firefox nor Safari)
    </li>
    <li>A USB micro-B data cable to connect to your computer. One end should look like this:</li>
    <img src="images/USB_Micro-B.svg" style="max-height: 2em;">
    and the other end should connect to your computer. It should also work if you need an adapter between your computer
    and the cable.
    <li>If you have set your browser to block third-party scripts, allow scripts to load from https://unpkg.com/</li>
    <li>One time-only: you'll possibly need to install a driver so your computer can talk to the microcontoller</li>
</ul>
<h2>Step 1: Connect the microcontroller to your computer</h2>
<p class="caution">Electronics like the microcontroller and other parts in the scarecrow can be damaged
    or destroyed by static electricity. Before working with electronic components...
    ⚡&nbsp;Discharge static electricity built up in your body by touching a cold water pipe or an unpainted center
    screw in a duplex electrical outlet.
    ⚡&nbsp;Avoid synthetic fabrics such as polyfleece.
</p>
<p>The scarecrow should be turned off and disconnected from 12V power (you don't need it).
    Put the cap on the laser module.</p>
<p>Use a good quality USB micro-B data cable (a charging-only cable won't work)
    to connect your computer to the ESP32 microcontroller on the circuit board.
    If you rotate the scarecrow so the key switch is toward you, the ESP32 microcontroller is on the left and its USB
    port is toward you.</p>
<section class="container text-center">
    <div class="row align-items-start">
        <figure class="col">
            <figcaption>ESP32 in 2023 scarecrow</figcaption>
            <img src="images/2023_esp32.png"></figure>
        <figure class="col">
            <figcaption>USB cable plugged in (white)</figcaption>
            <img src="images/2023_esp32_usb.png"></figure>
    </div>
</section>
<p>
    If making this connection is awkward (e.g., your cable is short), you may remove the microcontroller from
    the main board by holding the sides and pulling it straight up out of the socket.</p>
<p class="info">When connected to USB and still plugged into the main board, the scarecrow may make some sounds from the
    buzzer, including error tones. This is not a problem when updating the firmware.</p>
<h2 id="step2">Step 2: Install the driver, if needed</h2>
<p>Your computer might install the driver for you automatically when you connect the microcontroller. The easiest way to
    tell is if a confirmation (or error message) appears.
    If nothing obvious happens, go ahead and see if it works. If the port can&rsquo;t be found, try downloading and
    installing the driver yourself.</p>
<p>The EPS32 DevkitC use the <strong>CP2102</strong> USB interface chip from Silicon Labs. You can download the CP210x
    series driver
    from <a href="https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers?tab=downloads">
        https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers?tab=downloads
    </a>. You'll probably want the &ldquo; Universal Windows Driver&rdquo; or the &ldquo;CP210x VCP Mac OSX Driver&rdquo;.
</p>
<p>After downloading, unzip and run the installer.</p>
<h2>Step 3: Install the firmware for your scarecrow</h2>
<p>Click to select the model year of your scarecrow, then the &ldquo;Install...&rdquo; button that appears below it and
    follow the instructions that appear (you can look at the <a href="#walkthrough">walkthrough</a> first if you like).
    The model is also indicated on the label on the underside of the scarecrow.</p>
<div class="container text-center">
    <div class="row align-items-start">
        <div class="col">
            <label for="model2024" class="btn btn-outline-primary p-0">
                <img src="images/2024_model.png" alt="The 2024 scarecrow has a green octagonal circuit board">
                2024
            </label>
            <input type="radio" name="model" value="2024" id="model2024">
            <div>
                <esp-web-install-button manifest="ls2024-2.3.2_manifest.json">
                    <button slot="activate" class="btn btn-warning">Install v2.3.2 for 2024 model</button>
                </esp-web-install-button>
                <p class="small">This is the release version of the firmware; no changes have been made.</p>
            </div>
        </div>
        <div class="col">
            <label for="model2023" class="btn btn-outline-primary p-0">
                <img src="images/2023_model.png" alt="The 2023 scarecrow has a blue circular circuit board">
                2023
            </label>
            <input type="radio" name="model" value="2023" id="model2023">
            <div>
                <esp-web-install-button manifest="ls2022-2.0.1_manifest.json">
                    <button slot="activate" class="btn btn-warning">Install v2.0.1 for 2023 model</button>
                </esp-web-install-button>
                <p class="small">This update limits the maximum speed of the servo to help prevent premature
                    failure.</p>
            </div>
        </div>
        <div class="col">
            <label for="model2022" class="btn btn-outline-primary p-0">
                <img src="images/2022_model.png" alt="The 2022 scarecrow has a green circular circuit board">
                2022
            </label>
            <input type="radio" name="model" value="2022" id="model2022">
            <div>
                <esp-web-install-button manifest="ls2022-1.3.0_manifest.json">
                    <button slot="activate" class="btn btn-warning">Install v1.3.0 for 2022 model</button>
                </esp-web-install-button>
                <p class="small">This update improves the random motion when the active area allowed by the tape sensor
                    is very
                    small.</p>
            </div>
        </div>
    </div>
</div>
<section id="walkthrough">
    <h3>Installer walkthrough</h3>
    <p class="small">Hover over the images to enlarge. Where to click is circled in yellow.</p>
    <ul>
        <li>
            <a id="walkthrough_1" href="#walkthrough_1" class="btn border-1 border-info p-0 ms-2 d-block">
                <img src="images/1-select_port.png"
                     alt="screen capture showing port selection">
            </a>
            First, your browser will display a list of serial ports. Select the correct port and click Connect.
            <ul>
                <li>If no ports are listed (or if you get a screen saying you didn&rsquo;t select a port),
                    you might still need to install the driver (see <strong><a href="#step2">Step 2</a></strong>)... or
                    just try again.
                    we have one old computer in the lab that is so slow it always takes two tries.
                </li>
                <li>If multiple ports are listed, select the one that has &ldquo;CP2102N&rdquo;
                    in its name.
                </li>
                <li>If multiple ports show &ldquo;CP2102&rdquo;,
                    cancel, disconnect the ESP32, try again, write down the ports that are listed, cancel
                    again, reconnect the ESP32, and select the new port that wasn't in the previous list.
                </li>
            </ul>
        <li>
            <a id="walkthrough_2" href="#walkthrough_2" class="btn border-1 border-info p-0 ms-2">
                <img src="images/2-device_dashboard.png" alt="screen capture showing device dashboard">
            </a>
            From the &ldquo;Device Dashboard&ldquo;, confirm that you
            have selected the firmware for the correct model year, then click it if correct.
            Click the close button at the upper right (&times;) to cancel.
        </li>
        <li>
            <a id="walkthrough_3" href="#walkthrough_3" class="btn border-1 border-info p-0 ms-2">
                <img src="images/3-erase_device.png" alt="screen capture showing device erase option">
            </a>
            You have an option to erase the device. I have never found this to
            be necessary, but it won't hurt if you feel like enabling that checkbox.
            Click Next to continue or the close button at the upper right (&times;) to cancel.
        </li>
        <li>
            <a id="walkthrough_4" href="#walkthrough_4" class="btn border-1 border-info p-0 ms-2">
                <img src="images/4-confirm.png" alt="screen capture showing confirmation">
            </a>
            Last chance to confirm that you are installing the correct firmware for your scarecrow!
            You can still click the close button at the upper right (&times;) to cancel.
        </li>
        <li>
            <a id="walkthrough_6" href="#walkthrough_6" class="btn border-1 border-info p-0 ms-2">
                <img src="images/6-complete.png" alt="screen capture showing completion">
            </a>
            After usually less than the estimated 2 minutes, you should see that the installation is complete. Click
            next.
        </li>
        <li>
            <a id="walkthrough_7" href="#walkthrough_7" class="btn border-1 border-info p-0 ms-2">
                <img src="images/7-dashboard_close.png"
                     alt="screen capture showing dashboard with close button circled">
            </a>
            You will return to the dashboard and can click the close button at the upper right (&times;) to finish.
            If you have any doubts about whether the microcontroller is running the correct firmware,
            you may optionally click &ldquo;LOGS &amp; CONSOLE&rdquo;, then click &ldquo;RESET DEVICE&rdquo; and wait
            to check the last line after everything finishes scrolling. Then click &ldquo;BACK&rdquo; and close the
            updater or try again.
        </li>

    </ul>
</section>
<h2>Step 4: Disconnect the cable</h2>
<p>After the firmware has been updated, unplug the cable. (You don't need to &ldquo;eject&rdquo;/unmount it or
    anything.)</p>
<p>If you removed the microcontroller for easier access, replace it. Align each pin on the microcontroller with a hole
    in the sockets. Be sure that the USB micro connector is on the side of the board that also has the buzzer connector.
    Push straight down on the pins on the sides until the microcontroller board is flush with the top of the
    sockets.</p>
<h2>Step 5: Run a self-test</h2>
<p>The self-test procedure is in the URI Laser Scarecrow Operating Manual.
    If you need a copy, please visit <a href="https://laserscarecrow.info/">https://laserscarecrow.info/</a>.</p>

<aside style="float: right; max-width: 25%;"><img src="images/MOD-ESP32-DEVKITC-VIE.png"
                                                  alt="Photograph of the ESP32-DevKitC"
                                                  style="max-width: 100%; max-height: 128px;"></aside>
<h2>If you need to buy a new microcontroller</h2>
<p>The microcontroller for the 2022-2024 scarecrow models is the Espressif ESP32-DEVKITC-VIE.
    As of April 2024, these are still in mass production by the manufacturer. We have purchased them from...</p>
<ul>
    <li>
        <a href="https://www.digikey.com/en/products/detail/espressif-systems/ESP32-DEVKITC-VIE/12091811">Digikey</a>
    </li>
    <li>
        <a href="https://www.mouser.com/ProductDetail/Espressif-Systems/ESP32-DevKitC-VIE?qs=vmHwEFxEFR%252B9L5ZhUgeToA%3D%3D">Mouser</a>
    </li>
</ul>
<p>
    You can substitute <strong>only</strong> the ESP32-DevKitC-VE. (The only difference is the antenna which we don't
    use anyway.)
    There many other variations with similar names that <strong>will not work</strong>,
    so be careful if you search for a replacement online. Do not buy, for example,
    any of ESP32-DevKitC-32E, ESP32-DevKitC-32UE, or ESP32-DevKitC-DA.
</p>
<p><em>Huge thanks and credit to <a href="https://esphome.github.io/esp-web-tools/">ESP Web Tools</a>
    for making this (relatively) easy to use!</em></p>
<p class="small">USB micro-b image adapted from work by Fred the Oyster, CC BY-SA 4.0,
    https://commons.wikimedia.org/w/index.php?curid=36172898</p>
<footer>
    <img src="images/agronomy.png" alt="Vegetables at URI illustration" style="max-height: 5em;">
    <img src="images/danger.png" alt="FDA CDRH Class IIIB Laser Radiation Warning Label" style="max-height: 5em;">
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>